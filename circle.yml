general:
  branches:
    only:
      - test_circleci
  artifacts:
    - "log/"

machine:
  timezone: Asia/Shanghai
  ruby:
    version: 2.1.3


dependencies:
  cache_directories:
    - "~/.apt-cache"
  pre:
    - sudo mkdir -p ~/.apt-cache/partial
    - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10
    - echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/mongodb.list
    - sudo apt-get install -o dir::cache::archives=/home/ubuntu/.apt-cache -y python-software-properties software-properties-common
    - sudo add-apt-repository -y ppa:mc3man/trusty-media
    - sudo apt-get update -o dir::cache::archives=/home/ubuntu/.apt-cache
    - sudo apt-get install -o dir::cache::archives=/home/ubuntu/.apt-cache -y mongodb-org=2.6.9 mongodb-org-server=2.6.9 mongodb-org-shell=2.6.9 mongodb-org-mongos=2.6.9 mongodb-org-tools=2.6.9
    - sudo apt-get install -o dir::cache::archives=/home/ubuntu/.apt-cache -y qt5-default libqt5webkit5-dev qtdeclarative5-dev g++  xvfb ffmpeg

  override:
    - sed -i 's/https:\/\/ruby.taobao.org/https:\/\/rubygems.org/g' Gemfile
    - bundle install --deployment

test:
  override:
    - bundle exec rspec
